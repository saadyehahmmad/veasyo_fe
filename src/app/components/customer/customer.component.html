<div class="customer-wrapper">
  <app-customer-header></app-customer-header>

  @if (tableId() && !tableNotFound()) {
    <div class="customer-container">
      <div class="table-info">
        @if (tableDisplay()) {
          <h1>
            {{ tableDisplay()!.number }}
            @if (tableDisplay()!.name) {
              <span class="table-name"> - {{ tableDisplay()!.name }}</span>
            }
          </h1>
        }
        @if (tableDisplay()) {
          <div class="table-details">
            @if (tableDisplay()!.zone) {
              <span class="zone">
                <mat-icon>place</mat-icon> {{ tableDisplay()!.zone }}
              </span>
            }
            @if (tableDisplay()!.capacity) {
              <span class="capacity">
                <mat-icon>people</mat-icon> {{ tableDisplay()!.capacity }} {{ 'customer.seats' | translate }}
              </span>
            }
          </div>
        }
        @if (requestStatus()) {
          <p class="status">{{ requestStatus() }}</p>
        }
      </div>

      @if (!hasActiveRequest()) {
        <div class="actions">
          <!-- Menu Button - small height, full width, at the top -->
          @if (menuUrl()) {
            <a
              [href]="menuUrl()"
              target="_blank"
              rel="noopener noreferrer"
              class="menu-button"
            >
              <mat-icon>restaurant_menu</mat-icon>
              {{ 'customer.viewMenu' | translate }}
            </a>
          }

          <!-- Request Types Grid - 2 columns -->
          <div class="request-types-grid">
            @for (requestType of requestTypes(); track requestType.id) {
              <button
                mat-fab
                extended
                class="request-type-button"
                (click)="sendRequest(requestType.id)"
                [disabled]="isLoading()"
              >
                <mat-icon class="request-type-icon">{{ requestType.icon }}</mat-icon>
                {{ isLoading() ? ('customer.sending' | translate) : getRequestTypeName(requestType) }}
              </button>
            }

            <!-- Custom Request Button (shown only if enabled) -->
            @if (customRequestEnabled()) {
              <button
                mat-fab
                extended
                class="custom-button"
                (click)="toggleCustomInput()"
                [disabled]="isLoading()"
              >
                <mat-icon class="custom-icon">edit</mat-icon>
                {{ 'customer.customRequest' | translate }}
              </button>
            }
          </div>

          <!-- Custom Request Input -->
          @if (showCustomInput()) {
            <div class="custom-input">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>{{ 'customer.enterCustomRequest' | translate }}</mat-label>
                <input
                  matInput
                  [(ngModel)]="customMessage"
                  [placeholder]="'customer.customRequestPlaceholder' | translate"
                  (keyup.enter)="sendCustomRequest()"
                />
              </mat-form-field>
              <button
                mat-raised-button
                color="primary"
                (click)="sendCustomRequest()"
                [disabled]="!customMessage().trim()"
              >
                {{ 'customer.sendCustomRequest' | translate }}
              </button>
            </div>
          }
        </div>
      }

    <!-- Action Buttons when request is active -->
    @if (hasActiveRequest()) {
      <div class="action-section">
        <div class="action-buttons">
          @if (isWaiterComing()) {
            <button
              mat-raised-button
              color="primary"
              (click)="completeRequest()"
            >
              <mat-icon>check_circle</mat-icon>
              {{ 'customer.complete' | translate }}
            </button>
          }
          <button mat-raised-button color="warn" (click)="cancelRequest()">
            <mat-icon>cancel</mat-icon>
            {{ 'customer.cancel' | translate }}
          </button>
        </div>
        <p class="timer">{{ timerDisplay() }}</p>
      </div>
    }

    <!-- Feedback Form (shown after completing request) -->
    @if (showFeedbackForm()) {
      <div class="feedback-overlay">
        <div class="feedback-modal">
          <div class="feedback-header">
            <mat-icon class="feedback-icon">sentiment_satisfied_alt</mat-icon>
            <h2>{{ 'customer.feedbackTitle' | translate }}</h2>
            <p class="feedback-subtitle">{{ 'customer.feedbackSubtitle' | translate }}</p>
          </div>

          <div class="feedback-content">
            <!-- Star Rating -->
            <div class="rating-section">
              <label class="section-label">{{ 'customer.rateService' | translate }}</label>
              <app-star-rating
                [rating]="feedbackRating()"
                [size]="'large'"
                (ratingChange)="onRatingChange($event)"
              ></app-star-rating>
            </div>

            <!-- Comments/Complaints -->
            <div class="comments-section">
              <label class="section-label">{{ 'customer.additionalComments' | translate }}</label>
              <mat-form-field appearance="outline" class="full-width">
                <textarea
                  matInput
                  [(ngModel)]="feedbackComments"
                  [placeholder]="'customer.commentsPlaceholder' | translate"
                  rows="4"
                  maxlength="500"
                ></textarea>
              </mat-form-field>
            </div>

            <!-- User Info Collection (Creative Design) -->
            <div class="user-info-section">
              <div class="info-header">
                <mat-icon class="gift-icon">card_giftcard</mat-icon>
                <div class="info-text">
                  <h3>{{ 'customer.helpUsImprove' | translate }}</h3>
                  <p>{{ 'customer.shareDetails' | translate }}</p>
                </div>
              </div>

              <div class="info-fields">
                <mat-form-field appearance="outline" class="half-width">
                  <mat-label>{{ 'customer.yourName' | translate }} {{ 'customer.nameOptional' | translate }}</mat-label>
                  <input
                    matInput
                    [(ngModel)]="feedbackName"
                    [placeholder]="'customer.namePlaceholder' | translate"
                  />
                  <mat-icon matPrefix>person</mat-icon>
                </mat-form-field>

                <mat-form-field appearance="outline" class="half-width">
                  <mat-label>{{ 'customer.yourPhone' | translate }} {{ 'customer.phoneOptional' | translate }}</mat-label>
                  <input
                    matInput
                    [(ngModel)]="feedbackPhone"
                    [placeholder]="'customer.phonePlaceholder' | translate"
                    type="tel"
                  />
                  <mat-icon matPrefix>phone</mat-icon>
                </mat-form-field>
              </div>
            </div>
          </div>

          <div class="feedback-actions">
            <button
              mat-raised-button
              color="primary"
              (click)="submitFeedback()"
              [disabled]="isSubmittingFeedback()"
              class="submit-button"
            >
              @if (isSubmittingFeedback()) {
                <mat-icon class="spinning">sync</mat-icon>
              } @else {
                <mat-icon>send</mat-icon>
              }
              {{ 'customer.submitFeedback' | translate }}
            </button>
            <button
              mat-button
              (click)="skipFeedback()"
              [disabled]="isSubmittingFeedback()"
              class="skip-button"
            >
              {{ 'customer.skipFeedback' | translate }}
            </button>
          </div>
        </div>
      </div>
    }
  </div>
  }
  @if (!tableId() || tableNotFound()) {
    <div class="error">
      <mat-icon>error_outline</mat-icon>
      <p>{{ !tableId() ? ('customer.invalidTableId' | translate) : ('customer.tableNotRegistered' | translate) }}</p>
    </div>
  }

  <app-customer-footer></app-customer-footer>
</div>
